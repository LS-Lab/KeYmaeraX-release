<span ng-if="!highlight || collapsed" ng-bind-html="formulaStringHtml()">
</span>
<span frang-tree ng-if="highlight && !collapsed">
    <span frang-tree-repeat="expr in [formula.json]"
          class="k4-{{expr.kind}} k4-{{expr.step}} k4-{{expr.editable}}"
          id="fml_{{expr.id}}"
          ng-mouseover="exprMouseOver($event, expr.step, expr.editable)"
          ng-mouseout="exprMouseOut($event)"
          ng-click="exprClick($event, expr.id, expr.step, expr.editable)"
          ng-alt-click="exprClick($event, expr.id, expr.step, expr.editable)"
          ng-right-click="exprRightClick($event, expr.id, expr.step, expr.editable)">
        <span ng-if="modeIsEdit() && expr.plain">
            <span editable-text="replacePlainSpecialNotation(expr.plain)" onbeforesave="editExpr(expr.id, $data)">{{exprText(expr)}}</span>
        </span>
        <span ng-if="(modeIsProve() || modeIsSelect() || !expr.plain) && expr.text" ng-bind-html="exprTextHtml(expr)"></span>
        <span ng-if="(modeIsProve() || modeIsSelect() || !expr.plain) && expr.children && expr.children.length > 0"
              frang-tree-insert-children="expr.children"></span>
        </span>
    </span>
</span>
